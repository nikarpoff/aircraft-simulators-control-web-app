version: "3.9"

services:
  database:
    image: postgres:13.11
    environment:
      POSTGRES_DB: "aircraft_simulators_control"
      POSTGRES_PASSWORD: "postgres"
    ports:
      - 6432:5432
    command:
      - "postgres"
      - "-c"
      - "wal_level=logical"

  server:
    build:
      context: ./WebServer
      dockerfile: Dockerfile
    ports:
      - 8443:8443
    depends_on:
      - database

  # client:
  #   build: 
  #     context: ./frontend-app
  #     dockerfile: Dockerfile
  #   ports:
  #     - 3000:3000

  # zookeeper:
  #   image: confluentinc/cp-zookeeper:latest
  #   ports:
  #    - 22181:2181
  #    - 2888:2888
  #    - 3888:3888
  #   environment:
  #     ZOOKEEPER_CLIENT_PORT: 2181
  #     ZOOKEEPER_TICK_TIME: 2000

  # kafka:
  #   image: confluentinc/cp-kafka:latest
  #   depends_on:
  #     - zookeeper
  #   ports:
  #     - 29092:9092
  #   environment:
  #     KAFKA_BROKER_ID: 1
  #     KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
  #     KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:29092
  #     KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
  #     KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
  #     KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1

  # schema-registry:
  #   image: confluentinc/cp-schema-registry:7.0.1
  #   ports:
  #    - 8081:8081
  #    - 8181:8181
  #   environment:
  #    - SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS=kafka:9092
  #    - SCHEMA_REGISTRY_HOST_NAME=schema-registry
  #    - SCHEMA_REGISTRY_LISTENERS=http://schema-registry:8081
  #   links:
  #    - zookeeper

  # consumer1:
  #   build:
  #     context: ./Simulator
  #   environment:
  #     - KAFKA_BOOTSTRAPADDRESS=kafka:9092
  #     - KAFKA_TOPIC_LAB=postgres1.public.lab_work
  #     - KAFKA_TOPIC_MARK=postgres1.public.mark
  #     - KAFKA_TOPIC_STUDENT=postgres1.public.student
  #     - KAFKA_GROUPID=7654
  #     - SPRING_DATASOURCE_URL=jdbc:postgresql://postgres2:5432/students_marks_second
  #     - SPRING_DATASOURCE_DRIVERCLASSNAME=org.postgresql.Driver
  #     - SPRING_DATASOURCE_USERNAME=postgres
  #     - SPRING_DATASOURCE_PASSWORD=postgres
  #   links:
  #    - kafka
  #    - postgres2
  #   depends_on:
  #    - kafka
  #    - postgres1
